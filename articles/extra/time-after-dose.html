<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Time after dose • mrgsolve</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Time after dose">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">mrgsolve</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/mrgsolve.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/extra/dollar-pred.html">Models without compartments</a></li>
    <li><a class="dropdown-item" href="../../articles/extra/events.html">Event objects</a></li>
    <li><a class="dropdown-item" href="../../articles/extra/init.html">Set initial conditions</a></li>
    <li><a class="dropdown-item" href="../../articles/extra/modeled-event-time.html">Modeled events</a></li>
    <li><a class="dropdown-item" href="../../articles/extra/steady-state.html">Steady-state</a></li>
    <li><a class="dropdown-item" href="../../articles/extra/time-after-dose.html">Time after dose</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/metrumresearchgroup/mrgsolve/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Time after dose</h1>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2024-10-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/metrumresearchgroup/mrgsolve/blob/HEAD/vignettes/extra/time-after-dose.Rmd" class="external-link"><code>vignettes/extra/time-after-dose.Rmd</code></a></small>
      <div class="d-none name"><code>time-after-dose.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>TAD</code> stands for time after dose. In mrgsolve, any time
<code>TAD</code> is calculated automatically, a dose is a record in the
input data set where <code>EVID</code> is set to either 1 or 4.</p>
</div>
<div class="section level2">
<h2 id="tad-calculated-as-runtime-argument">TAD calculated as runtime argument<a class="anchor" aria-label="anchor" href="#tad-calculated-as-runtime-argument"></a>
</h2>
<p>For a while, you’ve been able to get time after dose in your
simulated output</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrgsolve.org/docs/">mrgsolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modlib.html">modlib</a></span><span class="op">(</span><span class="st">"pk1"</span>, req <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">4</span>, addl <span class="op">=</span> <span class="fl">3</span>, time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span>tad <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.888</span>,<span class="fl">5.91</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">##       ID  time   tad    CP</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1  0    -<span style="color: #BB0000;">2</span>     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1  1    -<span style="color: #BB0000;">1</span>     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1  2     0     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1  2     0     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1  3     1     3.07</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1  3.89  1.89  3.99</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1  4     2     4.05</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1  5     3     4.27</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1  5.91  3.91  4.22</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1  6     0     4.21</span></span></code></pre>
<p>This is convenient because you can choose the output at run time, we
give you the negative numbers prior to the first dose etc. This sort of
calculation is possible because we let mrgsolve know ahead of time that
we want this calculation done and mrgsolve makes an extra pass through
the records to find when is the first dose for each individual.</p>
</div>
<div class="section level2">
<h2 id="tad-calculated-in-the-model">TAD calculated in the model<a class="anchor" aria-label="anchor" href="#tad-calculated-in-the-model"></a>
</h2>
<p>Sometimes you would like to work with time after dose in your model.
This isn’t super-complicated to do but does require some programming and
setup and all of that. As of mrgsolve 0.9.1, there is a special function
to do these calculations for you.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mread.html">mread</a></span><span class="op">(</span><span class="st">"time-after-dose.txt"</span>,req <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Looking at the <code>[MAIN]</code> block:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"></code></pre></div>
<p>When you call <code>self.tad()</code> you will get the time after
dose. It’s important that this gets called on every record …
specifically every dosing record. It will not work properly if it is not
called every record and there is no check at this time to make sure you
follow that rule. So please follow the rule.</p>
<p>To see an example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">[</span> param <span class="op">]</span> CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> V <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> KA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="op">[</span> pkmodel <span class="op">]</span> cmt <span class="op">=</span> <span class="st">"GUT,CENT"</span><span class="op">,</span> depot <span class="op">=</span> TRUE</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span> </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>capture tadose <span class="op">=</span> self<span class="op">.</span>tad<span class="op">();</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="op">[</span> table<span class="op">]</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>capture CP  <span class="op">=</span> CENT<span class="op">/</span>V<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">4</span>, addl <span class="op">=</span> <span class="fl">3</span>, time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span>tad <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.888</span>, <span class="fl">5.91</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">##       ID  time   tad tadose    CP</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1  0    -<span style="color: #BB0000;">2</span>     -<span style="color: #BB0000;">1</span>     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1  1    -<span style="color: #BB0000;">1</span>     -<span style="color: #BB0000;">1</span>     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1  2     0     -<span style="color: #BB0000;">1</span>     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1  2     0      0     0   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1  3     1      1     3.07</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1  3.89  1.89   1.89  3.99</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1  4     2      2     4.05</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1  5     3      3     4.27</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1  5.91  3.91   3.91  4.22</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1  6     0      0     4.21</span></span></code></pre>
<p>You will notice two differences between <code>tad</code> (output
requested at run time) and <code>tadose</code> (values calculated in the
model itself) in the output listing above:</p>
<ol style="list-style-type: decimal">
<li>
<code>tadose</code> is -1 before the first dose</li>
<li>specifically, <code>tadose</code> is -1 at the 2 hour observation
record that occurs that the same time as the dose, but happens before
the dose in record order</li>
</ol>
<p>The main point if this is that you can easily obtain time after dose
in the problem (model) itself to use as you program the model and also
output the number into the simulated output.</p>
</div>
<div class="section level2">
<h2 id="time-after-dose-in-specific-compartment">Time after dose in specific compartment<a class="anchor" aria-label="anchor" href="#time-after-dose-in-specific-compartment"></a>
</h2>
<p>Version 0.10.7 adds a new plugin with the ability to calculate time
after dose in any compartment.</p>
<p>We write a model using the <code>tad</code> plugin to track time
after dose in compartments <code>one</code> and <code>two</code>. We
create <code>tadose</code> objects to track this and we can call the
<code>tad()</code> method on these objects, passing in the
<code>self</code> data item.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'</span></span>
<span><span class="st"></span></span>
<span><span class="st">[plugin] tad</span></span>
<span><span class="st"></span></span>
<span><span class="st">[ global ] </span></span>
<span><span class="st">mrg::tadose tad_cmt_1(1); </span></span>
<span><span class="st">mrg::tadose tad_cmt_2(2);</span></span>
<span><span class="st"></span></span>
<span><span class="st">[ pkmodel ] cmt = "GUT,CENT", depot = TRUE</span></span>
<span><span class="st"></span></span>
<span><span class="st">[ param ] CL = 1, V = 20, KA = 1</span></span>
<span><span class="st"></span></span>
<span><span class="st">[ main ] </span></span>
<span><span class="st">capture tad1 = tad_cmt_1.tad(self); </span></span>
<span><span class="st">capture tad2 = tad_cmt_2.tad(self);</span></span>
<span><span class="st"></span></span>
<span><span class="st">'</span></span>
<span>  </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mcode.html">mcode</a></span><span class="op">(</span><span class="st">"tad"</span>, <span class="va">code</span>, soloc <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span>, time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, cmt <span class="op">=</span> <span class="fl">2</span>, time <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Model:  tad </span></span>
<span><span class="co">## Dim:    27 x 6 </span></span>
<span><span class="co">## Time:   0 to 24 </span></span>
<span><span class="co">## ID:     1 </span></span>
<span><span class="co">##     ID time     GUT   CENT tad1 tad2</span></span>
<span><span class="co">## 1:   1    0   0.000   0.00   -1   -1</span></span>
<span><span class="co">## 2:   1    1   0.000   0.00   -1   -1</span></span>
<span><span class="co">## 3:   1    1 100.000   0.00    0   -1</span></span>
<span><span class="co">## 4:   1    2  36.788  61.41    1   -1</span></span>
<span><span class="co">## 5:   1    3  13.534  81.00    2   -1</span></span>
<span><span class="co">## 6:   1    3  13.534 281.00    2    0</span></span>
<span><span class="co">## 7:   1    4   4.979 275.61    3    1</span></span>
<span><span class="co">## 8:   1    5   1.832 265.22    4    2</span></span></code></pre>
<p>Note that time after dose is -1 until a dose is administered.</p>
<p>Recall also that time after dose can be calculated more simply if
there is only one dose type by passing the <code>tad</code>
argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">cmt</span> <span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op"><a href="../../reference/zchain.html">%&gt;%</a></span> <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span><span class="va">data1</span>, tad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Model:  tad </span></span>
<span><span class="co">## Dim:    26 x 7 </span></span>
<span><span class="co">## Time:   0 to 24 </span></span>
<span><span class="co">## ID:     1 </span></span>
<span><span class="co">##     ID time tad     GUT  CENT tad1 tad2</span></span>
<span><span class="co">## 1:   1    0  -3   0.000  0.00   -1   -1</span></span>
<span><span class="co">## 2:   1    1  -2   0.000  0.00   -1   -1</span></span>
<span><span class="co">## 3:   1    2  -1   0.000  0.00   -1   -1</span></span>
<span><span class="co">## 4:   1    3   0   0.000  0.00   -1   -1</span></span>
<span><span class="co">## 5:   1    3   0 100.000  0.00    0   -1</span></span>
<span><span class="co">## 6:   1    4   1  36.788 61.41    1   -1</span></span>
<span><span class="co">## 7:   1    5   2  13.534 81.00    2   -1</span></span>
<span><span class="co">## 8:   1    6   3   4.979 85.36    3   -1</span></span></code></pre>
<p>This is a little nicer because it will fill in negative
<code>tad</code> values for you.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle T Baron.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
