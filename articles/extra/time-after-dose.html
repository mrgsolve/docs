<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time after dose • mrgsolve</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Time after dose">
<meta property="og:description" content="mrgsolve">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">mrgsolve</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/mrgsolve.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/extra/dollar-pred.html">Models without compartments</a>
    </li>
    <li>
      <a href="../../articles/extra/events.html">Event objects</a>
    </li>
    <li>
      <a href="../../articles/extra/init.html">Set initial conditions</a>
    </li>
    <li>
      <a href="../../articles/extra/modeled-event-time.html">Modeled events</a>
    </li>
    <li>
      <a href="../../articles/extra/steady-state.html">Steady-state</a>
    </li>
    <li>
      <a href="../../articles/extra/time-after-dose.html">Time after dose</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/mrgsolve">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="time-after-dose_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Time after dose</h1>
                        <h4 class="author"></h4>
            
            <h4 class="date">2021-03-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/metrumresearchgroup/mrgsolve/blob/master/vignettes/extra/time-after-dose.Rmd"><code>vignettes/extra/time-after-dose.Rmd</code></a></small>
      <div class="hidden name"><code>time-after-dose.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>TAD</code> stands for time after dose. In mrgsolve, any time <code>TAD</code> is calculated automatically, a dose is a record in the input data set where <code>EVID</code> is set to either 1 or 4.</p>
</div>
<div id="tad-calculated-as-runtime-argument" class="section level1">
<h1 class="hasAnchor">
<a href="#tad-calculated-as-runtime-argument" class="anchor"></a>TAD calculated as runtime argument</h1>
<p>For a while, you’ve been able to get time after dose in your simulated output</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/metrumresearchgroup/mrgsolve">mrgsolve</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modlib.html">modlib</a></span><span class="op">(</span><span class="st">"pk1"</span>, req <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">4</span>, addl <span class="op">=</span> <span class="fl">3</span>, time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span>tad <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.888</span>,<span class="fl">5.91</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>. # A tibble: 10 x 4
.       ID  time   tad    CP
.    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
.  1     1  0    -2     0   
.  2     1  1    -1     0   
.  3     1  2     0     0   
.  4     1  2     0     0   
.  5     1  3     1     3.07
.  6     1  3.89  1.89  3.99
.  7     1  4     2     4.05
.  8     1  5     3     4.27
.  9     1  5.91  3.91  4.22
. 10     1  6     0     4.21</code></pre>
<p>This is convenient because you can choose the output at run time, we give you the negative numbers prior to the first dose etc. This sort of calculation is possible because we let mrgsolve know ahead of time that we want this calculation done and mrgsolve makes an extra pass through the records to find when is the first dose for each individual.</p>
</div>
<div id="tad-calculated-in-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#tad-calculated-in-the-model" class="anchor"></a>TAD calculated in the model</h1>
<p>Sometimes you would like to work with time after dose in your model. This isn’t super-complicated to do but does require some programming and setup and all of that. As of mrgsolve 0.9.1, there is a special function to do these calculations for you.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mread.html">mread</a></span><span class="op">(</span><span class="st">"time-after-dose.txt"</span>,req <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>Looking at the <code>[MAIN]</code> block:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"></code></pre></div>
<p>When you call <code>self.tad()</code> you will get the time after dose. It’s important that this gets called on every record … specifically every dosing record. It will not work properly if it is not called every record and there is no check at this time to make sure you follow that rule. So please follow the rule.</p>
<p>To see an example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>[ param ] CL = <span class="dv">1</span>, V = <span class="dv">20</span>, KA = <span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>[ pkmodel ] cmt = <span class="st">"GUT,CENT"</span>, depot = TRUE</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>[ main ] </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>capture tadose = self.tad();</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>[ table]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>capture CP  = CENT/V;</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">4</span>, addl <span class="op">=</span> <span class="fl">3</span>, time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span>tad <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.888</span>, <span class="fl">5.91</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>. # A tibble: 10 x 5
.       ID  time   tad tadose    CP
.    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
.  1     1  0    -2     -1     0   
.  2     1  1    -1     -1     0   
.  3     1  2     0     -1     0   
.  4     1  2     0      0     0   
.  5     1  3     1      1     3.07
.  6     1  3.89  1.89   1.89  3.99
.  7     1  4     2      2     4.05
.  8     1  5     3      3     4.27
.  9     1  5.91  3.91   3.91  4.22
. 10     1  6     0      0     4.21</code></pre>
<p>You will notice two differences between <code>tad</code> (output requested at run time) and <code>tadose</code> (values calculated in the model itself) in the output listing above:</p>
<ol style="list-style-type: decimal">
<li>
<code>tadose</code> is -1 before the first dose</li>
<li>specifically, <code>tadose</code> is -1 at the 2 hour observation record that occurs that the same time as the dose, but happens before the dose in record order</li>
</ol>
<p>The main point if this is that you can easily obtain time after dose in the problem (model) itself to use as you program the model and also output the number into the simulated output.</p>
</div>
<div id="time-after-dose-in-specific-compartment" class="section level1">
<h1 class="hasAnchor">
<a href="#time-after-dose-in-specific-compartment" class="anchor"></a>Time after dose in specific compartment</h1>
<p>Version 0.10.7 adds a new plugin with the ability to calculate time after dose in any compartment.</p>
<p>We write a model using the <code>tad</code> plugin to track time after dose in compartments <code>one</code> and <code>two</code>. We create <code>tadose</code> objects to track this and we can call the <code>tad()</code> method on these objects, passing in the <code>self</code> data item.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'

[plugin] tad

[ global ] 
mrg::tadose tad_cmt_1(1); 
mrg::tadose tad_cmt_2(2);

[ pkmodel ] cmt = "GUT,CENT", depot = TRUE

[ param ] CL = 1, V = 20, KA = 1

[ main ] 
capture tad1 = tad_cmt_1.tad(self); 
capture tad2 = tad_cmt_2.tad(self);

'</span>
  
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mcode.html">mcode</a></span><span class="op">(</span><span class="st">"tad"</span>, <span class="va">code</span>, soloc <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span>


<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, cmt <span class="op">=</span> <span class="fl">1</span>, time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, 
  <span class="fu"><a href="../../reference/ev.html">ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, cmt <span class="op">=</span> <span class="fl">2</span>, time <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>. Model:  tad 
. Dim:    27 x 6 
. Time:   0 to 24 
. ID:     1 
.     ID time     GUT   CENT tad1 tad2
. 1:   1    0   0.000   0.00   -1   -1
. 2:   1    1   0.000   0.00   -1   -1
. 3:   1    1 100.000   0.00    0   -1
. 4:   1    2  36.788  61.41    1   -1
. 5:   1    3  13.534  81.00    2   -1
. 6:   1    3  13.534 281.00    2    0
. 7:   1    4   4.979 275.61    3    1
. 8:   1    5   1.832 265.22    4    2</code></pre>
<p>Note that time after dose is -1 until a dose is administered.</p>
<p>Recall also that time after dose can be calculated more simply if there is only one dose type by passing the <code>tad</code> argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">cmt</span> <span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../../reference/mrgsim.html">mrgsim</a></span><span class="op">(</span><span class="va">data1</span>, tad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>. Model:  tad 
. Dim:    26 x 7 
. Time:   0 to 24 
. ID:     1 
.     ID time tad     GUT  CENT tad1 tad2
. 1:   1    0  -3   0.000  0.00   -1   -1
. 2:   1    1  -2   0.000  0.00   -1   -1
. 3:   1    2  -1   0.000  0.00   -1   -1
. 4:   1    3   0   0.000  0.00   -1   -1
. 5:   1    3   0 100.000  0.00    0   -1
. 6:   1    4   1  36.788 61.41    1   -1
. 7:   1    5   2  13.534 81.00    2   -1
. 8:   1    6   3   4.979 85.36    3   -1</code></pre>
<p>This is a little nicer because it will fill in negative <code>tad</code> values for you.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kyle T Baron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
